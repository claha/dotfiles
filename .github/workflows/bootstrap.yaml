---
name: Run bootstrap script

on:  # yamllint disable-line rule:truthy
  push:
    branches:
      - main
  pull_request:

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    container:
      image: archlinux:latest
      options: --privileged
    steps:
      - uses: actions/checkout@v3.6.0
      - run: |
          pacman --sync --refresh --noconfirm --sysupgrade python sudo
          useradd ansible --create-home
          passwd --delete ansible
          echo 'ansible ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
          sudo --user ansible ./bootstrap.sh
